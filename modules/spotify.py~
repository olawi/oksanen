#!/usr/bin/env python
# coding=utf-8

import re
import urllib
import htmllib

from ircbot import SingleServerIRCBot
from irclib import nm_to_n, nm_to_h, irc_lower, ip_numstr_to_quad

spotify_url = 'http://spotify.url.fi/'
spotify_uri_re = '(http:\/\/open.spotify.com\/|spotify:)(album|artist|track)([:\/])([a-zA-Z0-9]+)\/?'

def setup(self):
    self.pubhandlers.append(spotify)

def spotify(self, e, c):
    
    nick = nm_to_n(e.source())
    line = e.arguments()[0]

    sp_re = re.compile(spotify_uri_re);

    m = re.search(sp_re,line)

    if m:
        fd = urllib.urlopen("%s%s/%s"%(spotify_url,m.group(2),m.group(4)))
        
        
